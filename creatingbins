import pandas as pd
import numpy as np

# Convert sale_date to datetime
ice_cream_sales_data["sale_date"] = pd.to_datetime(ice_cream_sales_data["sale_date"])

# Month (number)
ice_cream_sales_data["month"] = ice_cream_sales_data["sale_date"].dt.month

# Temperature bins: [lower, upper) => include lower, exclude upper
bins = [-np.inf, 60, 70, 80, 90, 100, np.inf]
labels = [
    "Less than 60 degrees",
    "60 to less than 70 degrees",
    "70 to less than 80 degrees",
    "80 to less than 90 degrees",
    "90 to less than 100 degrees",
    "100 degrees or more"
]

ice_cream_sales_data["temperature_range"] = pd.cut(
    ice_cream_sales_data["temperature"],
    bins=bins,
    labels=labels,
    right=False,          # KEY: excludes upper bound
    include_lowest=True
)

# Pivot table: total sales volume by month and temperature range
pivot = ice_cream_sales_data.pivot_table(
    values="sales_volume",
    index="month",
    columns="temperature_range",
    aggfunc="sum",
    fill_value=0
)

print(pivot)
